pipeline {
    agent any

    environment {
        GIT_REPO = 'https://github.com/tpdebenjamin/projet_devops.git'
        GIT_CREDENTIALS_ID = 'projet_devops'
    }

    parameters {
        choice(name: 'MOIS', choices: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'], description: 'Sélectionnez un mois pour afficher son objectif.')
    }

    stages {
        stage('Checkout') {
            steps {
                echo "Clonage du repository depuis la branche main..."
                checkout([
                    $class: 'GitSCM', 
                    branches: [[name: 'main']], 
                    userRemoteConfigs: [[
                        url: env.GIT_REPO,
                        credentialsId: env.GIT_CREDENTIALS_ID
                    ]]
                ])
            }
        }

        stage('Build') {
            steps {
                echo 'Compilation du programme Java...'
                sh 'javac src/Main.java -d bin'
            }
        }

        stage('Run') {
            steps {
                echo "Exécution du programme pour le mois : ${params.MOIS}"
                sh "java -cp bin Main ${params.MOIS}"
            }
        }
    }

    post {
        always {
            echo 'Pipeline terminé.'
        }
        success {
            echo 'Pipeline exécuté avec succès !'
        }
        failure {
            echo 'Le pipeline a échoué. Vérifiez les erreurs.'
        }
    }
}
